#!/usr/bin/env bash
set -euo pipefail

export NIX_CONFIG="experimental-features = nix-command flakes"

if [[ "$(uname -a)" == *"aarch64"* || "$(uname -a)" == *"arm64"* ]]; then
	readonly PROFILE_ARCH="aarch64"
else
	readonly PROFILE_ARCH="x86_64"
fi

if [[ "$OSTYPE" == "linux"* ]]; then
	readonly PROFILE_SYSTEM="linux"
elif [[ "$OSTYPE" == "darwin"* ]]; then
	readonly PROFILE_SYSTEM="darwin"
fi

PS4="+> "
set -x

nix run .#home-manager -- switch --flake .#waciejm-${PROFILE_ARCH}-${PROFILE_SYSTEM}
